# Document d'exploitation - François BONNIN

Dans ce document nous allons voir quelles sont les fonctionnalités disponibles et comment y accéder.
Tout d'abord, allumer les différentes machines virtuels afin de mettre en route les serveurs web, le firewall PfSense et le serveur base de données MariaDB.

Le serveur base de donnée possède une interface graphique avec un navigateur afin de pouvoir avoir accès à l'interface web de notre PfSense au sein du LAN.

## Sommaire
1. [SSH](#ssh)
2. [HTTP](#http)
3. [Heartbeat](#heartbeat)

## SSH

A cause des conditions sanitaires actuels, il est important de mettre en place un accès à distance pour le télétravail sur notre infrastructure. Normalement un VPN serait obligatoire pour accorder cet accès à distance aux configuration en toute sécurité.
En l'occurence on travail uniquement depuis notre machine hôte donc on a juste fait une redirection de port (port-forwarding) sur le port ssh (port 22) via les règles NAT sur PfSense.

L'ip de notre interface WAN PfSense : 192.168.5.50.
Redirection mis en place :
<img src="https://cdn.discordapp.com/attachments/522143202426224654/846509750770466846/unknown.png" border=2px>

Ainsi pour accéder en ssh à une de nos machine (ex : base de donnée), il suffit de rentrer dans un terminale (MobaXterm ou cmd) : `ssh user@pfsenseWANaddress -p Dest.Ports`

Soit : 

* Cluster HeartBeat :
  - ssh : **ssh user@192.168.5.50 -p 2222**
  - http : **192.168.5.50:3222**
<br>

* Serveur Web1 :
  - ssh : **ssh user@192.168.5.50 -p 2223**
  - http : **192.168.5.50:3223**
<br>

* Serveur Web2 :
  - ssh : **ssh user@192.168.5.50 -p 2224**
  - http : **192.168.5.50:3224**
<br>

* Base de donnée:
  - ssh : **ssh user@192.168.5.50 -p 2225**
<br>

Après s'être connecté en **SSH** directement aux serveurs web, nous pouvons installer une application comme expliquer au sein de la documentation d'architecture.
<br>

## HTTP
Comme nous n'avons pas acheter le nom de domaine _projet-infra.fr_, il est nécessaire de configurer sur notre pc client, un fichier hosts dans lequel nous allons dire à notre pc que le nom de domaine _projet-infra.fr_ correspond à l'ip **192.168.5.50**:

Ainsi si vous êtes sur Windows, dans le fichier _unité système:\Windows\System32\Drivers\etc\hosts_, si vous êtes sur Linux c'est dans le fichier _/etc/hosts_  rajouter une ligne contenant :
```
192.168.5.50   projet-infra.fr
```

A présent pour accéder au site Wordpress, il suffit de se placer dans son navigateur et de rentrer **_projet-infra.fr:3222_**.

> Il faut spécifier pour le moment le port 3222, une redirection de port que j'avais mis en place lorsque le port par défaut étais déjà occupé.
<br>


## HeartBeat

Avec la mise en place de HeartBeat il est important de noter que si l'un de nos deux serveurs tombe en panne ou et mis hors service, alors l'adresse ip est automatiquement redirigé vers l'autre serveur. Ainsi avec ce programme, notre infrastructure est munis d'une haute-disponibilité permanente.